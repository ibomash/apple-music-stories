{"id":"apple-music-stories-0td","title":"iOS: Investigate missing Last.fm scrobble log entries","description":"User reports successful Last.fm sign-in; scrobbles may be working but in-app scrobble log stays empty. Verify log append path, candidate finalization, and scrobble status logging; add diagnostics if needed.","status":"open","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T11:25:59.499855-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T11:25:59.499855-05:00"}
{"id":"apple-music-stories-1x4","title":"Update scrobble completion guard + tests","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Replace the 90% threshold with a near-end guard (within 30s) and update tests.\n\nAcceptance criteria:\n- [ ] Completion guard rules implemented:\n  - duration \u003e= 60s: `playbackTime \u003e= duration - 30s`.\n  - duration \u003c 60s: `playbackTime \u003e= duration * 0.8`.\n  - duration missing: `playbackTime \u003e= 30s`.\n- [ ] Scrobble decision occurs at track end or stop using the latest playbackTime snapshot.\n- [ ] Unit tests updated/added for the new rules.\n\nNotes:\n- See `LastFMScrobblePolicy` and scrobble candidate finalization logic.","status":"open","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T15:57:30.112707-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T15:57:30.112707-05:00","dependencies":[{"issue_id":"apple-music-stories-1x4","depends_on_id":"apple-music-stories-9s0","type":"blocks","created_at":"2026-01-28T15:57:39.187276-05:00","created_by":"Illya Bomash"}]}
{"id":"apple-music-stories-3dv","title":"Enhance expanded now playing view","description":"Backlog: none\n\nGoal:\n- Expand the now playing sheet with richer metadata and navigation controls.","acceptance_criteria":"- [ ] Higher-res album art is used when available.\n- [ ] Artist, album, and track names are displayed.\n- [ ] Back button is present.\n- [ ] Forward button advances playback.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T22:26:06.38607-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T22:27:13.743715-05:00","closed_at":"2026-01-25T22:27:13.743717-05:00","labels":["ios"]}
{"id":"apple-music-stories-5f2","title":"Differentiate video links in web renderer","description":"Backlog: none\n\nGoal:\n- Differentiate video links from album/track in web renderer, add a badge, and remove Play button for videos.\n\nAcceptance criteria:\n- [ ] Album/track links retain their Play button and Open in Apple Music link.\n- [ ] Video links display a video badge distinct from album/track badges.\n- [ ] Video links do not render a Play button; only Open in Apple Music is shown.\n\nNotes:\n- Apply to web renderer link boxes.","notes":"Summary:\n- Added media badges for album/track/video and removed Play button for video cards in web renderer.\n- Video cards now only show Open in Apple Music.\n\nTests:\n- uv run scripts/render_story.py serve --host 127.0.0.1 --port 8000 \u0026 STORY_BASE_URL=http://127.0.0.1:8000 node scripts/puppeteer_story_test.js (failed: puppeteer module missing)","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-26T17:54:15.287595-05:00","created_by":"Illya Bomash","updated_at":"2026-01-26T17:56:33.518445-05:00","closed_at":"2026-01-26T17:56:33.51845-05:00"}
{"id":"apple-music-stories-607","title":"Design playback event architecture for scrobbling","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Produce a playback-event architecture write-up that ensures scrobbling gets reliable start/progress/end signals.\n\nAcceptance criteria:\n- [ ] Document available MusicKit event sources (player state, queue changes, playbackTime sampling).\n- [ ] Define event semantics: track start, progress updates, track end, interruptions/backgrounding.\n- [ ] Cover both ApplicationMusicPlayer and SystemMusicPlayer behaviors.\n- [ ] Recommend a concrete implementation (e.g., observers + periodic tick) and diagnostics to verify correctness.\n- [ ] Publish the write-up in `ios/architecture.md` or a new doc and link it from there.\n\nNotes:\n- Current code only observes `state.objectWillChange` and `queue.objectWillChange`, so playbackTime does not advance continuously.\n- Scrobble candidate finalizes on track change or playback stopped; missing progress updates can prevent meeting the threshold.\n- Include guidance on logging/telemetry to debug missing events.","notes":"Completed playback event architecture write-up in ios/architecture.md.\nSpec update: scrobble completion guard is within 30s of end for tracks \u003e= 60s; short tracks use 80% threshold; missing duration requires \u003e= 30s playbackTime.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T15:39:54.852156-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T15:53:26.79701-05:00","closed_at":"2026-01-28T15:42:39.894421-05:00"}
{"id":"apple-music-stories-7af","title":"iOS: Add Last.fm scrobbling support","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Add Last.fm auth, scrobbling, and visibility tooling to the iOS app.\n\nPlan:\n- Add Last.fm settings entry + screen with signed-out/signed-in/error states.\n- Add Last.fm config + Keychain-backed session storage and web auth flow.\n- Implement scrobble criteria + dedupe ledger + pending queue + logging.\n- Wire playback snapshots + lifecycle flush to scrobble manager.\n- Add unit + UI tests.","acceptance_criteria":"Scrobble activity visible via console logs and in-app log","notes":"Completed:\n- Added Last.fm settings entry, auth flow, scrobble manager, and scrobble log UI.\n- Wired playback snapshots and lifecycle flush; added persistence, dedupe, and logging.\n- Added unit tests for signature/policy/stores/auth state and UI test for settings.\n\nTests:\n- SNAPSHOT_RECORDING=1 ./scripts/ios.sh test","status":"closed","priority":2,"issue_type":"feature","owner":"ibomash@gmail.com","created_at":"2026-01-26T19:00:25.636071-05:00","created_by":"Illya Bomash","updated_at":"2026-01-26T19:23:44.647832-05:00","closed_at":"2026-01-26T19:23:44.647846-05:00","external_ref":"TASK-133"}
{"id":"apple-music-stories-93e","title":"Ensure story plays use full intent","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Treat all Music Stories plays as full (usePreview=false) while keeping preview capability for future use.\n\nAcceptance criteria:\n- [ ] Lead media play uses .full intent (no implicit preview).\n- [ ] Default intent resolution is .full when nil.\n- [ ] Diagnostic logs show intent=full for story-initiated playback.\n- [ ] Last.fm scrobbling no longer skips story plays due to preview intent.\n\nNotes:\n- Current preview sources: StoryRendererView lead media uses `.preview`; AppleMusicPlaybackController resolves nil to `.preview`.\n- `LastFMScrobbleManager` ignores snapshots when `usePreview` is true.\n- Update related tests if needed.","status":"open","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T15:39:47.169949-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T15:39:47.169949-05:00"}
{"id":"apple-music-stories-9s0","title":"Implement playback event sampling for scrobbling","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Emit reliable playback snapshots using MusicKit observers plus periodic sampling while playing.\n\nAcceptance criteria:\n- [ ] Playback snapshots emit on player state changes and queue changes.\n- [ ] While playing, a periodic tick samples `playbackTime` every 1-5s and emits snapshots.\n- [ ] Tick stops when not playing and resumes on play.\n- [ ] Active player switches (Application vs System) rebind observers correctly.\n- [ ] App lifecycle transitions capture a final snapshot and resume sampling on foreground.\n\nNotes:\n- This can live in `AppleMusicPlaybackController` or a small coordinator.\n- Include a `reason` in snapshots (state-change, queue-change, tick, lifecycle) for diagnostics.","status":"open","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T15:57:25.288129-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T15:57:25.288129-05:00"}
{"id":"apple-music-stories-c1f","title":"Add playback snapshot diagnostics for scrobbling","description":"Backlog: backlog/tasks/task-133 - iOS-Add-Last.fm-scrobbling-support.md\n\nGoal:\n- Add diagnostic logging for playback snapshots and scrobble candidate transitions.\n\nAcceptance criteria:\n- [ ] Log `playback_snapshot` events with track id, playback state, playback time, active player, and reason.\n- [ ] Log scrobble candidate start/update/finalize events with reason and track metadata.\n- [ ] Diagnostic JSONL export shows a complete lifecycle for a played track.\n\nNotes:\n- Use existing DiagnosticLogging pipeline.\n- Keep logs low-volume (tick logs can be sampled or throttled if needed).","status":"open","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-28T15:57:28.094951-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T15:57:28.094951-05:00","dependencies":[{"issue_id":"apple-music-stories-c1f","depends_on_id":"apple-music-stories-9s0","type":"blocks","created_at":"2026-01-28T15:57:35.67127-05:00","created_by":"Illya Bomash"}]}
{"id":"apple-music-stories-ksy","title":"Add diagnostic logging to iOS app","description":"Backlog: none\n\nGoal:\n- Add toggleable diagnostic logging that captures JSON lines with timestamps and keeps only last 24 hours.\n- Provide export to .jsonl via system share sheet and wipe logs when disabled.\n- Keep settings surfaced in the main page settings section near scrobbling.\n\nAcceptance criteria:\n- [ ] Logging can be enabled/disabled from the main page settings section.\n- [ ] When enabled, logs are timestamped JSON objects persisted in a .jsonl file.\n- [ ] Logs are automatically pruned to the last 24 hours.\n- [ ] Turning logging off deletes stored logs.\n- [ ] Users can export logs as a .jsonl file using the system share sheet.\n\nNotes:\n- Use SwiftUI patterns consistent with existing settings cards.\n- Keep new UI near Last.fm scrobbling settings.","status":"closed","priority":2,"issue_type":"feature","owner":"ibomash@gmail.com","created_at":"2026-01-28T12:17:39.150697-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T13:02:03.379336-05:00","closed_at":"2026-01-28T13:02:03.379336-05:00","close_reason":"done: added diagnostic logging for playback, queue, scrobbling, playlists"}
{"id":"apple-music-stories-my4","title":"Add skip-to-next button in collapsed view","description":"Backlog: none\n\nGoal:\n- Add a track-oriented skip-to-next control in the collapsed playback bar view.","acceptance_criteria":"- [ ] Collapsed playback bar shows a next-track button.\n- [ ] Button triggers playback of the next track when available.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T22:26:05.932939-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T22:27:13.419094-05:00","closed_at":"2026-01-25T22:27:13.419125-05:00","labels":["ios"]}
{"id":"apple-music-stories-nla","title":"Add album-wide progress bar","description":"Backlog: backlog/tasks/task-93 - Add-album-wide-progress-bar.md\n\nGoal:\n- Show an album-wide progress indicator across tracks in the playback UI.\n\nNotes:\n- Album progress = sum played time across album tracks / total album duration.","acceptance_criteria":"- [ ] Album-wide progress bar appears for album playback.\n- [ ] Progress updates smoothly as tracks advance.\n- [ ] Progress resets when album changes.","status":"closed","priority":2,"issue_type":"feature","owner":"ibomash@gmail.com","created_at":"2026-01-25T21:43:42.245375-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T21:54:03.740183-05:00","closed_at":"2026-01-25T21:54:03.740193-05:00","external_ref":"TASK-93","labels":["ios"]}
{"id":"apple-music-stories-nla.1","title":"Model album progress aggregation","description":"Compute album progress as total album duration vs. played time (previous tracks + current track progress). Update on track change and playback time updates.","acceptance_criteria":"- [ ] Album progress percent is correct for initial track.\n- [ ] Album progress percent advances with playback time.\n- [ ] Album progress percent jumps when track changes.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T21:43:42.476075-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T21:54:03.214895-05:00","closed_at":"2026-01-25T21:54:03.214898-05:00","labels":["ios"],"dependencies":[{"issue_id":"apple-music-stories-nla.1","depends_on_id":"apple-music-stories-nla","type":"parent-child","created_at":"2026-01-25T21:43:42.476922-05:00","created_by":"Illya Bomash"}]}
{"id":"apple-music-stories-nla.2","title":"Add album progress bar UI","description":"Add an album-wide progress bar to the playback UI that is visible for album playback and hides for non-album queues.","acceptance_criteria":"- [ ] Progress bar renders in playback UI for album queue.\n- [ ] Progress bar uses existing progress styling if available.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T21:43:42.714216-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T21:54:03.385646-05:00","closed_at":"2026-01-25T21:54:03.385649-05:00","labels":["ios"],"dependencies":[{"issue_id":"apple-music-stories-nla.2","depends_on_id":"apple-music-stories-nla","type":"parent-child","created_at":"2026-01-25T21:43:42.714984-05:00","created_by":"Illya Bomash"}]}
{"id":"apple-music-stories-nla.3","title":"Wire updates and tests for album progress","description":"Wire album progress updates to playback state and add/update tests if coverage exists for playback progress.","acceptance_criteria":"- [ ] Album progress updates during playback.\n- [ ] Progress resets when album changes.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T21:43:42.941626-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T21:54:03.558144-05:00","closed_at":"2026-01-25T21:54:03.558147-05:00","labels":["ios"],"dependencies":[{"issue_id":"apple-music-stories-nla.3","depends_on_id":"apple-music-stories-nla","type":"parent-child","created_at":"2026-01-25T21:43:42.942432-05:00","created_by":"Illya Bomash"}]}
{"id":"apple-music-stories-o14","title":"Fix Open in Apple Music context menu","description":"Backlog: none\n\nGoal:\n- Use the Apple Music deep link when selecting Open in Apple Music from an album context menu.\n\nAcceptance criteria:\n- [ ] Album context menu Open in Apple Music opens the album in the Music app instead of starting playback.\n- [ ] Other context menu actions remain unchanged.\n\nNotes:\n- Issue observed on album media cards.","notes":"Completed: context menu now opens Apple Music deep link instead of triggering playback. Tests: ./scripts/ios.sh swift-test.","status":"closed","priority":2,"issue_type":"bug","owner":"ibomash@gmail.com","created_at":"2026-01-28T13:03:06.644102-05:00","created_by":"Illya Bomash","updated_at":"2026-01-28T13:04:00.467082-05:00","closed_at":"2026-01-28T13:04:00.467091-05:00"}
{"id":"apple-music-stories-ra1","title":"Show album + track in collapsed view","description":"Backlog: none\n\nGoal:\n- Display the track title after the album name in the collapsed playback bar when space permits.","acceptance_criteria":"- [ ] Album title appears before track title in collapsed view for album playback.","status":"closed","priority":2,"issue_type":"task","owner":"ibomash@gmail.com","created_at":"2026-01-25T22:26:06.157085-05:00","created_by":"Illya Bomash","updated_at":"2026-01-25T22:27:13.584913-05:00","closed_at":"2026-01-25T22:27:13.584915-05:00","labels":["ios"]}
